I"<h2 id="clob-칼럼-사용이-많을-경우-문제가-될까요수정필요">CLOB 칼럼 사용이 많을 경우 문제가 될까요?(수정필요)</h2>

<ul>
  <li>스토리지 공간에서 많은 공간을 차지합니다.</li>
  <li>temp 영역이 full 찰 수 있습니다.</li>
  <li>merge문에 CLOB 칼럼이 있을 경우 에러가 발생할 수 있습니다.
    <ul>
      <li>ORA-03137: TTC protocol internal error : [12333] [254] [163] [15] [] [] [] []</li>
      <li>위의 에러는 merge문에 길이가 긴 bind 변수가 쓰일 경우 문제가 됩니다.(long, CLOB 등)</li>
    </ul>
  </li>
</ul>

<p><strong>CLOB 대신 varchar2 사용</strong></p>
<ul>
  <li>CLOB의 사용은 꼭 필요한 경우가 아니라면 권장하지 않습니다.</li>
  <li>varchar2(4000)을 사용할 것을 권장드립니다.</li>
</ul>

<h2 id="부가-설명">부가 설명</h2>

<p><strong>CLOB 칼럼</strong></p>
<ul>
  <li>varchar2  최대 크기 = 4000bytes이기 대량의 데이터를 담을 때 적합하지 않음.</li>
  <li>CLOB 최대 크기 = (4GB - 1) * DB_BLOCK_SIZE(8k)</li>
  <li>테이블 당 생성할 수 있는 최대 개수는 일반 column을 포함해서 1000개 =&gt; The absolute maximum number of columns in a table is 1000</li>
</ul>

<p><strong>1. 스토리지 공간에서 많은 공간을 차지합니다.</strong></p>
<ul>
  <li>하나의 table에 CLOB column이 많을 경우 스토리지 영역을 많이 차지하므로 필요한 부분에만 써야합니다.</li>
  <li>즉, 4000bytes 이내로 처리가능하면 varchar2 사용 권장.</li>
  <li>
    <p>예를 들면 4GB CLOB colmn을 가진 테이블의 데이터가 1000개 있을 경우 4GB * 1000 만큼의 공간을 차지합니다.</p>

    <p><strong>문제점</strong></p>
    <ul>
      <li>테이블이 대용량일 경우 Archive log mode라면 archiive log file이 기하급수적으로 증가</li>
      <li>따라서, redo log 기록 금지(nologging  적용), parallel과 direct load 로 작업시간 줄이기</li>
    </ul>
  </li>
</ul>

<p><strong>2. temp 영역이 full 찰 수 있습니다.</strong></p>
<blockquote>
  <ul>
    <li>select 쿼리라면</li>
  </ul>
</blockquote>

<blockquote>
  <blockquote>
    <ul>
      <li>clob 컬럼을 가공하지 않았을 경우
        <blockquote>
          <p>Temp segment가 발생하지 않습니다.</p>
        </blockquote>
      </li>
      <li>clob 컬럼을 substr을 사용했을 경우
        <blockquote>
          <p>temp segment가 발생했으며 size가 계속 증가합니다.</p>
        </blockquote>
      </li>
      <li>clob 컬럼을 substr을 사용 했으며, 코딩시 free Temporary을 사용 했을 경우
        <blockquote>
          <p>Temp segment가 발생 했다가 없어집니다.
즉, clob컬럼을 가공하여 사용할 경우 코딩시 free Temporary을 사용해야 합니다.</p>
        </blockquote>
      </li>
    </ul>
  </blockquote>
</blockquote>

<blockquote>
  <ul>
    <li>insert 쿼리라면</li>
  </ul>
</blockquote>

<blockquote>
  <blockquote>
    <ul>
      <li>free Temporary을 사용 하지 않은경우
temp segments가 계속 증가, 트랜잭션 종료 후에도 size가 release되지 않았음.<br />
(size는 clob컬럼의 block크기만큼 증가하는걸로 판단됨)</li>
      <li>free Temporary을 사용한 경우
Temp segment가 발생 했다가 없어집니다.<br />
즉, insert쿼리에서는 코딩시에도 free Temporary을 사용해야 함.</li>
    </ul>
  </blockquote>
</blockquote>

:ET